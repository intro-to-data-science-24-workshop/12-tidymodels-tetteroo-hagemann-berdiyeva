---
title: "Modelling with `tidymodels`"
subtitle: "Practice Materials"
author: "Franke Tetteroo, Linus Hagemann & Sofiya Berdiyeva"
date: "28.10.2024"
output: 
    rmdformats::robobook:
    toc: TRUE
    df_print: paged
    number_sections: FALSE
    highlight: tango
    toc_depth: 3
    toc_float: true
    self_contained: false
---

```{=html}
<style>
.h1,h2,h3 {
color:#2f1a61;
}

.subtitle, section.normal {
color:#291854;
}

.title {
color:#cc0065;
}

.nav-pills>li>a{
color: #2f1a61;
}

.nav-pills>li.active>a, .nav-pills>li.active>a:hover, .nav-pills>li.active>a:focus {
color: #fff;
background-color: #2f1a61;
}

.nav-tabs>li>a{
color: #2f1a61;
}

.nav-tabs>li.active>a, .nav-tabs>li.active>a:hover, .nav-tabs>li.active>a:focus {
color: #fff;
background-color: #2f1a61;
}

div.danger {background-color:#c42d2d; color:white; border-radius: 5px; padding: 20px;}

</style>
```
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```

# Introduction

This session is designed to guide you through the entire modelling process to familiarize yourself with some of the power of the packages in `tidymodels`. 

We will cover:

- splitting your data-set into a training and a test set using `rsample`,
- pre-processing your data-set using `recipes`,
- fitting a model using `parsnip`,
- and finally evaluate the performance of the model using `yardstick`.

For those of you attending this session live - stay tuned, as __there will be a price to be won in the end__!

![](./attendance_price.jpg)

::: danger
⚠️ __Attention__

Modelling is an extremely complex topic. Choosing an appropriate model for a specific task requires theoretical deliberation and careful consideration of the data at hand. As was seen in the lecture, hand-picking specific model configurations can rightfully be criticized and requires justification grounded in theory.

All of these are outside of the scope of this workshop - we aim at giving you a glimpse on how to use selected `R` packages. Doing so in a very condensed fashion requires us to take some shortcuts and trade-offs. Please be mindful of this when consulting this material for your future modelling adventures - there's a lot of more to think about!
:::

# Our Dataset

Throughout this exercise, we are working with a specially prepared version of the [`ames`](https://jse.amstat.org/v19n3/decock/DataDocumentation.txt) data-set, which is part of the `modeldata` package. The data-set contains information about houses in the region of Ames in Iowa (US). We prepared a smaller version of the data-set for this unit, in order to reduce the amount of different features (columns) to understand in the data-set and introduce some need for pre-processing.

```{r}
# install.packages("tidymodels")
library(tidymodels)
load("ames_workshop.RData") # executing this line will lead to the `ames_workshop` df becoming available in your environment
ames_workshop
```

As we can see, there are close to 3000 houses in the data-set, with 16 data points for each house.

The following table gives you a quick overview of the available features (in the order in which the columns appear in the data frame). More detailed information can be found [here](https://jse.amstat.org/v19n3/decock/DataDocumentation.txt).

| Name         | Description                                                       |
|--------------|-------------------------------------------------------------------|
| MS_Zoning    | Identifies the general zoning classification of the sale.         |
| Lot_Frontage | Linear feet of street connected to property                       |
| Lot_Area     | Lot size in square feet                                           |
| Utilities    | Type of utilities available                                       |
| Neighborhood | Physical locations within Ames city limits (map available)        |
| Condition_1  | Proximity to various conditions                                   |
| Condition_2  | Proximity to various conditions (if more than one is present)     |
| Overall_Cond | Rates the overall condition of the house                          |
| Exter_Cond   | Evaluates the present condition of the material on the exterior   |
| Foundation   | Type of foundation                                                |
| Heating      | Type of heating                                                   |
| Year_Sold    | Year Sold (YYYY)                                                  |
| Garage_Area  | Size of garage in square feet                                     |
| Mo_Sold      | Month Sold (MM)                                                   |
| Sale_Price   | Sale price \$$                                                    |
| secret_sauce | A special feature just for you! Can this improve our predictions? |

Our goal in this session is to predict the `Sale_Price` of a house based on the other available data-points. For this, we will build a linear model. You can already start to think about which features you think would be most useful for this task! 

# Splitting the Data-Set


# Example.
    
1. Loading and transforming the data with recipe


2. Sampling & bootstrapping


3. Model creation


4. Evaluation



```{r eval = FALSE}
# parsnip model ALWAYS returns the results as a data frame 
predictions <- bind_cols(
  select(auto_test, mpg),
  predict(model, auto_test)
)

# And here comes yardstick
# When "truth" is a factor: accuracy and the Kappa
# When "truth" is numeric: rmse, rsq and mae.

# Estimate one or more common performance estimates depending on the class of truth 
metrics(predictions, truth = older, estimate = .pred)

# Regression metrics
reg_metrics <- metric_set(huber_loss, iic, mape, mase)

# The returned function has the same arguments as metrics()
reg_metric(predictions, truth = mpg, estimate = .pred)

```


# Exercise.

1. Loading and transforming the data with recipe


2. Sampling & bootstrapping


3. Model creation


4. Evaluation

```{r eval = FALSE}
# TO BE CORRECTED!!!

predictions_lm <- bind_cols(
 select(auto_test, mpg),
 predict(linreg_reg_model, auto_test)
)

# One or more common performance estimates
# metrics(data= YOUR CODE, truth = YOUR CODE, estimate = YOUR CODE)

# Calculate symmetric mean absolute percentage error
# Who has the lowest value?

# Answer: smape(predictions_lm, truth = mpg, estimate = .pred)

# OR

# Calculate the coefficient of determination (the traditional one)
# Who has the highest value?

# Answer: rsq_trad(predictions_lm, truth = mpg, estimate = .pred)
```

# Sources

Include Sources Here
